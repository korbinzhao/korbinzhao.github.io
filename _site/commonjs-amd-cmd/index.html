<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Joebon
    -->
    <meta charset="utf-8" />
    <title>前端模块化规范 - CommonJS、AMD & CMD | Joebon's world</title>
    <meta name="author" content="Joebon" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Joebon's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Joebon</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/zbin1202/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/korbinzhao/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
            <!-- <a href="http://instagram.com/beiyuu/" target="_blank" style="text-align:right"><img src="http://d36xtkk24g8jdx.cloudfront.net/bluebar/00c6602/images/ico/favicon.ico" alt="" width="22"/></a> -->
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/commonjs-amd-cmd" title="前端模块化规范 - CommonJS、AMD & CMD">前端模块化规范 - CommonJS、AMD & CMD</a></h1>
        <p class="entry-date">2015-10-25</p>
        <p>前端为什么会出现模块化这个概念，主要原因是随着前端项目的复杂性和项目团队规模的扩大，命名冲突和文件依赖成为影响前端开发效率的两个重要问题。模块化规范的另一个目的是提高JS程序的可移植性。</p>

<h2>CommonJS</h2>

<p>官方JavaScript规范定义的API主要是为了构建基于浏览器端的应用程序。在服务器端，并没有官方的API定义。</p>

<p>CommonJS定义了许多普通应用程序（主要指非浏览器应用）使用的API，它的终极目标是提供一个类似Python、Ruby和Java的标准库，从而开发者可以使用CommonJS API编写可以运行在不同JS解释器和不同主机环境的应用程序。</p>

<ul>
<li><p>NodeJS和CommonJS之间的关系</p>

<p>  CommonJS是一种规范，NodeJS是这种规范的实现。JavaScript作为本地变成语言这种特殊应用程序，也是随着NodeJS的火热而进入大众的视野。</p></li>
<li><p>浏览器加载 CommonJS 模块的原理与实现</p>

<p>  npm的模块都是JS语言写的，但是浏览器用不了，因为浏览器不支持CommonJS格式。要想让浏览器用上这些模块，必须转换格式。</p>

<p>  浏览器不兼容CommonJS的根本原因，在于缺少四个Node.js环境的变量。</p>

<pre><code>  module
  exports
  require
  global
</code></pre>

<p>  只要能够提供这四个变量，浏览器就能加载CommonJS模块。</p></li>
<li><p>Browserify的实现</p></li>
</ul>


<p>知道了原理，就能做出工具了。Browserify（require('modules') in the browser）是目前最常用的CommonJS格式转换的工具。</p>

<p>举例：
main.js模块加载foo.js模块</p>

<pre><code>// foo.js
module.exports = function(x) {
  console.log(x);
};

// main.js
var foo = require("./foo");
foo("Hi");
</code></pre>

<p>使用下面的命令，就能将main.js转为浏览器可用的格式。</p>

<pre><code>$ browserify main.js &gt; compiled.js
</code></pre>

<p>Browserify到底做了什么？安装一下browser-unpack，就能看清楚了。</p>

<pre><code>$ npm install browser-unpack -g
</code></pre>

<p>然后，将前面生成的compile.js解包。</p>

<pre><code>$ browser-unpack &lt; compiled.js

[
  {
    "id":1,
    "source":"module.exports = function(x) {\n  console.log(x);\n};",
    "deps":{}
  },
  {
    "id":2,
    "source":"var foo = require(\"./foo\");\nfoo(\"Hi\");",
    "deps":{"./foo":1},
    "entry":true
  }
]
</code></pre>

<p>可以看到，browerify将所有模块放入一个数组，id属性是模块的编号，source属性是模块的源码，deps属性是模块的依赖。</p>

<p>因为main.js里面加载了foo.js，所以deps属性就制定./foo对应的1号模块。执行的时候，浏览器遇到require('./foo')语句，就自动执行1号模块的source属性，并就爱那个执行后的module.exports属性值输出。</p>

<h2>AMD</h2>

<p>AMD（异步模块定，Asynchronous Module Definition）格式总体的目标是为现在的开发者提供一个可用的模块化JS解决方案。</p>

<p>CommonJS通过引入模块化使得在服务器端编写JS应用成为可能，但是由于一个重大的局限，使得CommonJS规范不适用与浏览器环境。举例如下。</p>

<pre><code>var math = require('math');
　　math.add(2, 3);
</code></pre>

<p>第二行math.add(2, 3)，在第一行require('math')之后运行，因此必须等math.js加载完成。也就是说，如果加载时间很长，整个应用就会停在那里等。</p>

<p>这对服务器端不是一个问题，因为所有的模块都存放在本地硬盘，可以同步加载完成，等待时间就是硬盘的读取时间。但是，对于浏览器，这确实一个大问题，因为模块都放在服务器端，等待时间取决于网速的快慢，可能要等很长时间，浏览器处于“假死”状态。</p>

<p>因此，浏览器端的模块，不能采用“同步加载”（synchronous），只能采用“异步加载”（asynchronous）。这就是AMD规范诞生的背景。</p>

<p>AMD是“Asynchronous Module Definition”的缩写，意思就是“异步模块定义”。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p>

<p>AMD也采用require()语句加载模块，但是不同于CommonJS，他要求两个参数：</p>

<pre><code>require([module], callback);
</code></pre>

<p>第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数callback，则是加载成功之后的回调函数。</p>

<h2>CMD</h2>

<p>CMD（Common Module Definition）模块定义规范，是@玉伯提出的一个类似于AMD的规范，该规范明确了模块的基本书写格式和基本交互规则。</p>

<h3>AMD和CMD的区别</h3>

<p>下面来看下@玉伯给出的官方解释。</p>

<p>AMD和CMD等规范的目的都是为了JS的模块化开发，特别是在浏览器端的。目前这些规范的实现都能达成浏览器端模块化开发的目的。</p>

<p>区别在于：</p>

<ol>
<li>对于依赖的模块，AMD是提前执行，CMD是延迟执行。不过RequireJS从2.0开始，也改成了可以延迟执行（根据写法不同，处理方式不同）。CMD推崇as lazy as possible。</li>
<li><p>CMD推崇依赖就近，AMD推崇依赖前置。如下：</p>

<pre><code> // CMD
 define(function(require, exports, module) {   
     var a = require('./a')   
     a.doSomething()   
     // 此处略去 100 行   
     var b = require('./b') // 依赖可以就近书写   
     b.doSomething()   
     // ... 
 })

 // AMD 默认推荐的是
 define(['./a', './b'], function(a, b) {  
     // 依赖必须一开始就写好    
     a.doSomething()    
     // 此处略去 100 行    
     b.doSomething()    
     ...
 })
</code></pre>

<p> 虽然AMD也支持CMD的写法，同时还支持require作为依赖项传递，但RequireJS官方文档里默认上面的模块定义写法。</p></li>
<li><p>AMD的API默认是一个当多个用，CMD的API严格区分，推崇职责单一。比如AMD里，require分全局require和局部require，都叫require。CMD里，没有全局require，而是根据模块系统的完备性，提供seajs.use来实现模块系统的加载启动。CMD里，每个API都简单纯粹。</p></li>
</ol>


<h2>参考资料</h2>

<ol>
<li><a href="http://www.cnblogs.com/fullhouse/archive/2011/07/15/2107416.html">什么是CommonJS？</a></li>
<li><a href="http://www.feeldesignstudio.com/2013/09/javascript-module-pattern-commonjs/">JavaScript模块化开发（二）——CommonJS规范</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/05/commonjs-in-browser.html">浏览器加载 CommonJS 模块的原理与实现</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html">Javascript模块化编程（二）：AMD规范</a></li>
<li><a href="http://www.zhihu.com/question/20351507">AMD 和 CMD 的区别有哪些？- 知乎</a></li>
</ol>



        <!--<div id="disqus_container">-->
            <!--<div style="margin-bottom:20px" class="right">-->
                <!--<script type="text/javascript" charset="utf-8">-->
                <!--(function(){-->
                  <!--var _w = 86 , _h = 16;-->
                  <!--var param = {-->
                    <!--url:location.href,-->
                    <!--type:'6',-->
                    <!--count:'', /**是否显示分享数，1显示(可选)*/-->
                    <!--appkey:'', /**您申请的应用appkey,显示分享来源(可选)*/-->
                    <!--title:'', /**分享的文字内容(可选，默认为所在页面的title)*/-->
                    <!--pic:'', /**分享图片的路径(可选)*/-->
                    <!--ralateUid:'1742737645', /**关联用户的UID，分享微博会@该用户(可选)*/-->
                    <!--language:'zh_cn', /**设置语言，zh_cn|zh_tw(可选)*/-->
                    <!--rnd:new Date().valueOf()-->
                  <!--}-->
                  <!--var temp = [];-->
                  <!--for( var p in param ){-->
                    <!--temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )-->
                  <!--}-->

                  <!--document.write('<iframe allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?' + temp.join('&') + '" width="'+ _w+'" height="'+_h+'"></iframe>')-->
                <!--})()-->
                <!--</script>-->
            <!--</div>-->
            <!--&lt;!&ndash; <a href="#" class="comment" onclick="return false;">点击查看评论</a> &ndash;&gt;-->
             <!--<div id="disqus_thread"></div>-->
        <!--</div>-->

      <!-- 多说评论框 start -->
      <div class="ds-thread" data-thread-key="/commonjs-amd-cmd" data-title="前端模块化规范 - CommonJS、AMD & CMD" data-url="http://joebon.cc/commonjs-amd-cmd"></div>
      <!-- 多说评论框 end -->
      <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
        var duoshuoQuery = {short_name:"joebon"};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
      </script>
      <!-- 多说公共JS代码 end -->

    </div>

    <div class="sidenav">
       <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=1742737645&verifier=a3b2e71b&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

    <div class="sidenav">
        <h2>FE</h2>
        <ul class="artical-list">
        
            <li><a href="/js-scroll-direction">原生JS实现页面滚动方向检测</a></li>
        
            <li><a href="/commonjs-amd-cmd">前端模块化规范 - CommonJS、AMD & CMD</a></li>
        
            <li><a href="/cross-origin-js">JS跨域问题解决方式</a></li>
        
            <li><a href="/mac-os-x-shortcut">Mac OS X 快捷键</a></li>
        
            <li><a href="/nodejs-express-mongodb-website">nodejs+mongdb+express建站学习中所踩得坑</a></li>
        
            <li><a href="/introduction-to-svg">SVG入门</a></li>
        
            <li><a href="/cocos2d-event-dispatcher">Cocos2d-X 3.0 事件分发机制</a></li>
        
        </ul>

        <h2>Product</h2>
        <ul class="artical-list">
        
            <li><a href="/key-indicator-website-analysis">网站分析指标</a></li>
        
            <li><a href="/become-a-regular-worker">入职了，转正了</a></li>
        
            <li><a href="/about-method">关于方法</a></li>
        
            <li><a href="/about-thinking">关于思考</a></li>
        
        </ul>

        <h2>Life</h2>
        <ul class="artical-list">
        
            <li><a href="/first-douban-activity">第一次豆瓣活动：Coursera公开课之Public Speaking小分队——找回爱交流的自己</a></li>
        
            <li><a href="/restart">平凡之路，重新出发</a></li>
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>


    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>
</body>
</html>
