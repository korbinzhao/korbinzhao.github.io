<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Joebon
    -->
    <meta charset="utf-8" />
    <title>nodejs+mongdb+express建站学习中所踩得坑 | Joebon's world</title>
    <meta name="author" content="Joebon" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Joebon's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Joebon</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/zbin1202/" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="http://www.douban.com/people/korbinzhao/" target="_blank" style="text-align:center;"><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
            <!-- <a href="http://instagram.com/beiyuu/" target="_blank" style="text-align:right"><img src="http://d36xtkk24g8jdx.cloudfront.net/bluebar/00c6602/images/ico/favicon.ico" alt="" width="22"/></a> -->
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/nodejs-express-mongodb-website" title="nodejs+mongdb+express建站学习中所踩得坑">nodejs+mongdb+express建站学习中所踩得坑</a></h1>
        <p class="entry-date">2015-06-02</p>
        <h2>网站开发框架</h2>

<p>在网站开发之前，我们首先对网站开发框架进行设计。主要分为后端、前端、本地开发环境三部分。</p>

<ol>
<li><p>网站后端由nodejs支撑，同时安装nodejs框架express，数据库选择mongodb，同时选择对mongodb进行快速建模的工具mongoose，后端模板引擎选择jade，日期和时间的格式化选择moment.js，express、mongoose、jade、moment.js都通过npm模块安装包来安装。</p></li>
<li><p>前端选择jQuery类库、Bootstrap样式框架，jQuery和Bootstrap都属于前端静态资源，使用Bower来安装它们，Bower也是一个npm安装模块，因此也需要使用npm安装。</p></li>
<li><p>本地开发环境用到less的编译、cssmin样式合并、JSHint前后端单元测试的实现等。</p></li>
</ol>


<p><img src="/images/nodejs-express-mongondb-website/website-framework.png" title="website framework" alt="website framework" /></p>

<p>视频教程详见<a href="http://www.imooc.com/learn/75" title="imooc.com">imooc.com</a></p>

<h2>nodejs的安装</h2>

<p>开发前需要先安装[nodejs]，通过nodejs官网即可完成nodejs的安装。</p>

<h2>mongodb的安装</h2>

<p>mongodb是一个高性能、开源、无模式的文档型数据库（非关系型数据库），是当前NoSql数据库中比较热门的一种。mongodb中的一条记录就是一个文档（document），它的数据结构由键值对组成。mongodb文档和JSON对象很相似。</p>

<p>拓展：NoSql，全称是Not Only Sql，指的是非关系型数据库。下一代数据库主要解决几个要点：非关系型、分布式、开源、水平可拓展。</p>

<p>开发前mongodb需要单独安装。这也是我在不了解情况下踩过的一个坑，mongoose是mongodb的快速建模工具，通过npm安装mongoose并不会同时安装mongodb，且在安装完成mongobd后，在运行node app.</p>

<p>首先安装<a href="https://www.mongodb.org/" title="mongodb">mongodb</a>,js本地查看网站效果前，必须前行启动mongodb，并与node连接起来。在项目文件夹imooc下新建data文件夹用于存放mongdb数据。</p>

<pre><code>cd d:/fe_exercise/imooc
mkdir data
</code></pre>

<p>进入mongodb的安装目录 D:\Program Files\MongoDB 2.6 Standard下的bin文件夹中执行：</p>

<pre><code>cd d:/Program Files/MongoDB 2.6 Standard/bin
mongod --dbpath "d:/fe_exercise/imooc/data"
</code></pre>

<p>出现以下结果则证明连接成功。</p>

<p><img src="/images/nodejs-express-mongondb-website/mongodb-node-link.png" title="mongodb-node-link" alt="mongodb-node-link" /></p>

<p>每次本地查看网站前，用命令行启动mongodb，并将mongodb和node连接是一件很麻烦的事情。可以通过一种相对简单方法可以简化这个过程。具体方法如下：</p>

<p>新建一个名为mongodb.cmd的文件，文件内容如下。</p>

<pre><code>:: 定位到D盘
d:
:: 切换到mongodb的数据库目录
cd Program files\MongoDB 2.6 Standard\data
:: 删除数据库锁定记录文件
if exist mongod.lock del mongod.lock missing
:: 切换到mongodb的bin目录
cd ..\bin
:: 配置mongodb的文档存储目录
mongod --dbpath "D:\fe_exercise\imooc\data"
</code></pre>

<p>双击运行，即可完成启动mongodb，连接mongodb和node的过程。</p>

<h2>mongodb可视化管理工具：rockmongo的安装与配置</h2>

<p>rockmongo是一个用PHP5写的mongodb可视化管理工具。</p>

<p><strong>下载rockmongo</strong></p>

<p><a href="http://rockmongo.com/downloads" title="rockmongo">rockmongo官网</a>目前无法访问，可选择另一种替代方式：直接访问<a href="https://github.com/iwind/rockmongo" title="rockmongo">rockmongo github地址</a>，选择一个版本进行下载，本文选用1.1.7版本。</p>

<p><strong>安装PHP环境</strong></p>

<p>rockmongo的运行需要PHP环境，本文选用<a href="http://pan.baidu.com/s/1c0dInYg" title="appserv">AppServ 2.5.1</a>进行PHP、Apache等环境的打包安装，AppServ是PHP网页架站工具组合包，所包含的软件有：Apache、Apache Monitor、MySQL、PHPMyAdmin等。AppServ 2.5.1中PHP版本为PHP 5.2。下载AppServ点击安装，本文选用安装目录为C:/AppServ。</p>

<p>将上文中从github上下载的rockmongo 1.1.7文件夹重命名为rockmongo，放到AppServ安装目录下的www文件夹中：C:/AppServ/www。</p>

<p><strong>下载mongodb-php拓展</strong></p>

<p>根据所安装的PHP版本选择相应的mongo-php驱动拓展，本文PHP版本为5.2，因此选择PHP 5.2 VC6 Thread-Safe Mongo extension：<a href="http://pan.baidu.com/s/1eQo33kI" title="mongo-php-driver">mongo-php-driver</a>，将下载目录中的php_mongo.dll文件copy到C:/AppServ/php5/ext中。</p>

<p><strong>修改php.ini文件</strong></p>

<p>在php.ini文件中添加extension=php_mongo.dll</p>

<p><strong>重启Apache服务</strong></p>

<p>重启Apache服务</p>

<p><strong>修改rockmongo中的文件config..php</strong></p>

<p>设置以下内容的USERNAME和PASSWORD，将两者均设为root</p>

<pre><code>$MONGO["servers"][$i]["control_users"]["root"] = "root";//one of control users ["USERNAME"]=PASSWORD, works only if mongo_auth=false
</code></pre>

<p><strong>使用rockmongo登录mongodb</strong></p>

<p>访问http://localhost/rockmongo,界面如下：</p>

<p><img src="/images/nodejs-express-mongondb-website/login.png" title="login" alt="login" /></p>

<p>登录后界面如下：</p>

<p><img src="/images/nodejs-express-mongondb-website/dbview.png" title="dbview" alt="dbview" /></p>

<h2>项目结构的初始化</h2>

<p>进入项目目录，运行Node.js command prompt,运行以下代码：</p>

<pre><code>- imooc/
 &gt; npm install express
 &gt; npm install jade
 &gt; npm install mongoose
 &gt; npm install bower -g
 &gt; npm install bootstrap
</code></pre>

<p>通过npm对项目中使用的框架和模块进行安装之后就可以正式开始项目开发了。具体项目源码见<a href="https://github.com/korbinzhao/exercise/tree/master/imooc" title="imooc github">github仓库</a>。</p>


        <!--<div id="disqus_container">-->
            <!--<div style="margin-bottom:20px" class="right">-->
                <!--<script type="text/javascript" charset="utf-8">-->
                <!--(function(){-->
                  <!--var _w = 86 , _h = 16;-->
                  <!--var param = {-->
                    <!--url:location.href,-->
                    <!--type:'6',-->
                    <!--count:'', /**是否显示分享数，1显示(可选)*/-->
                    <!--appkey:'', /**您申请的应用appkey,显示分享来源(可选)*/-->
                    <!--title:'', /**分享的文字内容(可选，默认为所在页面的title)*/-->
                    <!--pic:'', /**分享图片的路径(可选)*/-->
                    <!--ralateUid:'1742737645', /**关联用户的UID，分享微博会@该用户(可选)*/-->
                    <!--language:'zh_cn', /**设置语言，zh_cn|zh_tw(可选)*/-->
                    <!--rnd:new Date().valueOf()-->
                  <!--}-->
                  <!--var temp = [];-->
                  <!--for( var p in param ){-->
                    <!--temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )-->
                  <!--}-->

                  <!--document.write('<iframe allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?' + temp.join('&') + '" width="'+ _w+'" height="'+_h+'"></iframe>')-->
                <!--})()-->
                <!--</script>-->
            <!--</div>-->
            <!--&lt;!&ndash; <a href="#" class="comment" onclick="return false;">点击查看评论</a> &ndash;&gt;-->
             <!--<div id="disqus_thread"></div>-->
        <!--</div>-->

      <!-- 多说评论框 start -->
      <div class="ds-thread" data-thread-key="/nodejs-express-mongodb-website" data-title="nodejs+mongdb+express建站学习中所踩得坑" data-url="http://joebon.cc/nodejs-express-mongodb-website"></div>
      <!-- 多说评论框 end -->
      <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
        var duoshuoQuery = {short_name:"joebon"};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
      </script>
      <!-- 多说公共JS代码 end -->

    </div>

    <div class="sidenav">
       <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=1742737645&verifier=a3b2e71b&colors=d6f3f7,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>
    </div>

    <div class="sidenav">
        <h2>FE</h2>
        <ul class="artical-list">
        
            <li><a href="/middleware&plugins">nodejs 中间件 & 插件</a></li>
        
            <li><a href="/comparing-escape-encodeURI-and-encodeURIComponent">字符编码扫盲及escape, encodeURI 和 encodeURIComponent方法比较</a></li>
        
            <li><a href="/upload-image-simulate-post-form">模拟form表单上传图片</a></li>
        
            <li><a href="/clipboard-image-upload">剪切板粘贴上传图片功能的实现</a></li>
        
            <li><a href="/date-cross-browser-safari-chrome">Date对象的浏览器兼容性问题</a></li>
        
            <li><a href="/js-scroll-direction">原生JS实现页面滚动方向检测</a></li>
        
            <li><a href="/commonjs-amd-cmd">前端模块化规范 - CommonJS、AMD & CMD</a></li>
        
            <li><a href="/cross-origin-js">JS跨域问题解决方式</a></li>
        
            <li><a href="/mac-os-x-shortcut">Mac OS X 快捷键</a></li>
        
            <li><a href="/nodejs-express-mongodb-website">nodejs+mongdb+express建站学习中所踩得坑</a></li>
        
            <li><a href="/introduction-to-svg">SVG入门</a></li>
        
            <li><a href="/cocos2d-event-dispatcher">Cocos2d-X 3.0 事件分发机制</a></li>
        
        </ul>

        <h2>Product</h2>
        <ul class="artical-list">
        
            <li><a href="/about-life-style">关于生活方式</a></li>
        
            <li><a href="/key-indicator-website-analysis">网站分析指标</a></li>
        
            <li><a href="/become-a-regular-worker">入职了，转正了</a></li>
        
            <li><a href="/about-method">关于方法</a></li>
        
            <li><a href="/about-thinking">关于思考</a></li>
        
        </ul>

        <h2>Life</h2>
        <ul class="artical-list">
        
            <li><a href="/hair-transplant">嗯，植发了</a></li>
        
            <li><a href="/a-meal-with-colleagues">和PD、运营、设计师和用研们的一顿饭</a></li>
        
            <li><a href="/first-douban-activity">第一次豆瓣活动：Coursera公开课之Public Speaking小分队——找回爱交流的自己</a></li>
        
            <li><a href="/restart">平凡之路，重新出发</a></li>
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>


    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>

    <!--Google analytics站点统计-->
    <!--https://analytics.google.com/analytics/web/?et&authuser=0#management/Settings/a72552547w110260152p115008802/%3Fm.page%3DTrackingCode%26_r.ghFlowId%3D6324039/-->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-72552547-1', 'auto');
        ga('send', 'pageview');

    </script>
</body>
</html>
